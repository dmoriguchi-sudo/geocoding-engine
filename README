https://geocoding-engine-959189601741.asia-northeast1.run.app/docs

# ğŸ—ºï¸ Geocoding Engine API

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.109-green.svg)](https://fastapi.tiangolo.com/)

ä½æ‰€ãƒªã‚¹ãƒˆã‚’ç·¯åº¦ãƒ»çµŒåº¦ã«å¤‰æ›ã™ã‚‹æ±ç”¨APIã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚  
Google Cloud Runä¸Šã§å‹•ä½œã—ã€GASã‚„ä»»æ„ã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã›ã¾ã™ã€‚

**ğŸŒ Swagger UI**: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªä»•æ§˜æ›¸**ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

- [ç‰¹å¾´](#ç‰¹å¾´)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜](#ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜)
- [ä½¿ç”¨ä¾‹](#ä½¿ç”¨ä¾‹)
- [ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †](#ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †)
- [è¨­è¨ˆæ€æƒ³](#è¨­è¨ˆæ€æƒ³)
- [åˆ¶é™äº‹é …](#åˆ¶é™äº‹é …)
- [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹](#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹)

---

## âœ¨ ç‰¹å¾´

- âœ… **ä¸€æ‹¬å¤‰æ›**: æœ€å¤§5,000ä»¶ã®ä½æ‰€ã‚’ä¸€åº¦ã«å¤‰æ›
- âš¡ **ä¸¦åˆ—å‡¦ç†**: 5ã‚¹ãƒ¬ãƒƒãƒ‰ã§é«˜é€ŸGeocoding
- ğŸ”“ **æ±ç”¨API**: GASã€Pythonã€JavaScriptç­‰ã‚ã‚‰ã‚†ã‚‹ç’°å¢ƒã‹ã‚‰åˆ©ç”¨å¯èƒ½
- ğŸ“– **è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: Swagger UIã§ä»•æ§˜ã‚’ç¢ºèªã—ãªãŒã‚‰ãƒ†ã‚¹ãƒˆå¯èƒ½
- ğŸš€ **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**: Google Cloud Runã§è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«
- ğŸ”‘ **ã‚·ãƒ³ãƒ—ãƒ«ãªI/O**: idã¨ä½æ‰€ã‚’æŠ•ã’ã‚‹ã ã‘ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯idä»˜ãJSON

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
gcloud run deploy geocoding-engine \
  --source . \
  --region asia-northeast1 \
  --allow-unauthenticated \
  --memory 512Mi \
  --timeout 3600 \
  --set-env-vars GOOGLE_MAPS_API_KEY=YOUR_API_KEY
```

### 2. APIã‚’å©ã

```bash
curl -X POST "https://YOUR-CLOUD-RUN-URL/geocode" \
  -H "Content-Type: application/json" \
  -d '{
    "data": [
      {"id": "001", "address": "æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1"},
      {"id": "002", "address": "æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-1-5"}
    ]
  }'
```

### 3. Swagger UIã‚’é–‹ã

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `https://YOUR-CLOUD-RUN-URL/` ã«ã‚¢ã‚¯ã‚»ã‚¹ â†’ **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªä»•æ§˜æ›¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™**

---

## ğŸ“¡ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜

### `GET /`
Swagger UIï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ä»•æ§˜æ›¸ï¼‰ã‚’è¡¨ç¤º

### `GET /health`
ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{ "status": "ok" }
```

### `POST /geocode`
ä½æ‰€ â†’ ç·¯åº¦çµŒåº¦å¤‰æ›

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "data": [
    { "id": "ä»»æ„ã®è­˜åˆ¥å­", "address": "ä½æ‰€æ–‡å­—åˆ—" },
    { "id": "001", "address": "æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1" },
    { "id": "002", "address": "æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-1-5" },
    { "id": "003", "address": "" }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "results": [
    { "id": "001", "lat": 35.6812362, "lng": 139.7671248, "status": "SUCCESS" },
    { "id": "002", "lat": 35.6627103, "lng": 139.7315695, "status": "SUCCESS" },
    { "id": "003", "lat": null,       "lng": null,        "status": "NO_ADDRESS" }
  ],
  "summary": {
    "total": 3,
    "success": 2,
    "not_found": 0,
    "no_address": 1,
    "error": 0,
    "elapsed_seconds": 1.23
  }
}
```

---

## ğŸ’¡ ä½¿ç”¨ä¾‹

### Google Apps Script (GAS)

```javascript
function geocodeSample() {
  const ENGINE_URL = 'https://YOUR-CLOUD-RUN-URL/geocode';

  const payload = {
    data: [
      { id: '001', address: 'æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1' },
      { id: '002', address: 'æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-1-5' }
    ]
  };

  const response = UrlFetchApp.fetch(ENGINE_URL, {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload),
    muteHttpExceptions: true
  });

  const result = JSON.parse(response.getContentText());
  
  // çµæœã‚’å‡¦ç†
  result.results.forEach(r => {
    if (r.status === 'SUCCESS') {
      Logger.log(`${r.id}: ${r.lat}, ${r.lng}`);
    }
  });
}
```

### Python

```python
import requests

url = "https://YOUR-CLOUD-RUN-URL/geocode"
payload = {
    "data": [
        {"id": "001", "address": "æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1"},
        {"id": "002", "address": "æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-1-5"}
    ]
}

response = requests.post(url, json=payload)
result = response.json()

for r in result['results']:
    print(f"{r['id']}: {r['lat']}, {r['lng']} ({r['status']})")
```

### JavaScript (fetch)

```javascript
const response = await fetch('https://YOUR-CLOUD-RUN-URL/geocode', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    data: [
      { id: '001', address: 'æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1' },
      { id: '002', address: 'æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-1-5' }
    ]
  })
});

const result = await response.json();
console.log(result);
```

---

## ğŸ› ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### å‰ææ¡ä»¶
- Google Cloud SDK ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«èª²é‡‘è¨­å®šæ¸ˆã¿
- Google Maps Geocoding API æœ‰åŠ¹åŒ–æ¸ˆã¿
- APIã‚­ãƒ¼å–å¾—æ¸ˆã¿

### æ‰‹é †

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/YOUR-USERNAME/geocoding-engine.git
cd geocoding-engine

# 2. Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run deploy geocoding-engine \
  --source . \
  --region asia-northeast1 \
  --allow-unauthenticated \
  --memory 512Mi \
  --timeout 3600 \
  --set-env-vars GOOGLE_MAPS_API_KEY=YOUR_API_KEY
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
geocoding-engine/
â”œâ”€â”€ main.py           # FastAPIã‚¢ãƒ—ãƒªæœ¬ä½“
â”œâ”€â”€ Dockerfile        # ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©
â”œâ”€â”€ requirements.txt  # ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â””â”€â”€ README.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ’­ è¨­è¨ˆæ€æƒ³

### ãªãœCloud Runã‹
- **GASã®6åˆ†åˆ¶é™ã‚’å›é¿**ã™ã‚‹ãŸã‚
- 13,000ä»¶è¶…ã®å¤§é‡å‡¦ç†ã§ã‚‚æ™‚é–“åˆ¶é™ãªã—
- GASã¯URLå©ãã ã‘ â†’ å½¹å‰²ã‚’åˆ†é›¢

### ãªãœidã‚’è‡ªç”±ã«ã—ãŸã‹
- å¾—æ„å…ˆã‚³ãƒ¼ãƒ‰ãƒ»è¡Œç•ªå·ãƒ»ä»»æ„ã®æ–‡å­—åˆ—ã‚’æ¸¡ã›ã‚‹
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®idã¯å¿…ãšãƒªã‚¯ã‚¨ã‚¹ãƒˆã®idã¨ä¸€è‡´**ã™ã‚‹ãŸã‚ã€å‘¼ã³å‡ºã—å…ƒãŒè‡ªç”±ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹
- è¤‡æ•°ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ»è¤‡æ•°ç”¨é€”ã§åŒã˜ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ã„å›ã›ã‚‹

### ä¸¦åˆ—å‡¦ç†ã«ã¤ã„ã¦
- 5ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦åˆ—Geocoding
- Google Maps API ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™å†…ã§æœ€å¤§åŠ¹ç‡
- 500ä»¶ â†’ ç´„30ç§’ã€13,000ä»¶ â†’ ç´„15åˆ†

---

## âš ï¸ åˆ¶é™äº‹é …

| é …ç›® | åˆ¶é™ |
|------|------|
| æ¨å¥¨æœ€å¤§ | 5,000ä»¶ / ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆï¼‰ |
| å®Ÿéš›ã®åˆ¶é™ | **ãªã—**ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ3,600ç§’ä»¥å†…ã«å‡¦ç†ã§ãã‚‹ç¯„å›²ï¼‰ |
| ä¸¦åˆ—ã‚¹ãƒ¬ãƒƒãƒ‰æ•° | 5 |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 3,600ç§’ï¼ˆ1æ™‚é–“ï¼‰ |
| APIåˆ©ç”¨æ–™é‡‘ | Google Maps Geocoding API ã®æ–™é‡‘ãŒç™ºç”Ÿ |

### ğŸ“Š å‡¦ç†é€Ÿåº¦ã®ç›®å®‰

| å‡¦ç†å¯¾è±¡ | å‡¦ç†æ™‚é–“ | å‡¦ç†é€Ÿåº¦ |
|---------|---------|---------|
| 500ä»¶ | ç´„30ç§’ | ç´„1,000ä»¶/åˆ† |
| 5,000ä»¶ | ç´„5åˆ† | ç´„1,000ä»¶/åˆ† |
| 13,000ä»¶ | ç´„15åˆ† | ç´„850ä»¶/åˆ† |

**GASæ¯”è¼ƒ:**
- GASï¼ˆMaps.newGeocoderï¼‰: ç´„50ä»¶/åˆ†
- **Cloud Runï¼ˆæœ¬ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰: ç´„1,400ä»¶/åˆ†**
- **ç´„30å€ã®é«˜é€ŸåŒ–** âš¡

### ğŸ’¡ å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†

13,000ä»¶è¶…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹å ´åˆã§ã‚‚ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ3,600ç§’ï¼‰å†…ã§ã‚ã‚Œã°åˆ¶é™ãªãå‡¦ç†å¯èƒ½ã§ã™ã€‚

**ä¾‹:** 50,000ä»¶ã®å ´åˆ
- æ¨å®šå‡¦ç†æ™‚é–“: ç´„50åˆ†
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 60åˆ†
- â†’ å‡¦ç†å¯èƒ½ âœ…

ãŸã ã—ã€**åˆ†å‰²ã—ã¦æŠ•ã’ã‚‹æ–¹ãŒæ¨å¥¨**ã§ã™ï¼š
- ãƒªãƒˆãƒ©ã‚¤ãŒå®¹æ˜“
- ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã®ç‰¹å®šãŒç°¡å˜
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ãƒªã‚¹ã‚¯è»½æ¸›

---

## ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§

| status | æ„å‘³ | latã®å€¤ |
|--------|------|---------|
| `SUCCESS` | æ­£å¸¸ã«åº§æ¨™å–å¾— | æ•°å€¤ |
| `NOT_FOUND` | ä½æ‰€ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | null |
| `NO_ADDRESS` | ä½æ‰€ãŒç©ºæ–‡å­— | null |
| `ERROR: ...` | APIã‚¨ãƒ©ãƒ¼ï¼ˆè©³ç´°ä»˜ãï¼‰ | null |

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æœ¬ç•ªé‹ç”¨æ™‚ã®æ¨å¥¨è¨­å®š

```bash
# èªè¨¼å¿…é ˆã«ã™ã‚‹
gcloud run deploy geocoding-engine \
  --no-allow-unauthenticated

# Cloud Armorã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™
gcloud compute security-policies create geocoding-rate-limit \
  --rate-limit-threshold-count=1000 \
  --rate-limit-threshold-interval-sec=60
```

### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

APIã‚­ãƒ¼ã¯**Secret Manager**ã§ç®¡ç†ã—ã¦ãã ã•ã„ï¼š

```bash
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä½œæˆ
echo -n "YOUR_API_KEY" | gcloud secrets create google-maps-api-key --data-file=-

# Cloud Runã«ãƒã‚¦ãƒ³ãƒˆ
gcloud run services update geocoding-engine \
  --update-secrets=GOOGLE_MAPS_API_KEY=google-maps-api-key:latest
```

---

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ­“è¿ã§ã™ï¼

1. Fork
2. Feature branchã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. Commit (`git commit -m 'Add amazing feature'`)
4. Push (`git push origin feature/amazing-feature`)
5. Pull Requestã‚’ä½œæˆ

---

## ğŸ“§ ãŠå•ã„åˆã‚ã›

Issue: [GitHub Issues](https://github.com/YOUR-USERNAME/geocoding-engine/issues)

---

**Built with â¤ï¸ using FastAPI + Google Cloud Run**
